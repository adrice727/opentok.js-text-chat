(function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a=typeof require=="function"&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);var f=new Error("Cannot find module '"+o+"'");throw f.code="MODULE_NOT_FOUND",f}var l=n[o]={exports:{}};t[o][0].call(l.exports,function(e){var n=t[o][1][e];return s(n?n:e)},l,l.exports,e,t,n,r)}return n[o].exports}var i=typeof require=="function"&&require;for(var o=0;o<r.length;o++)s(r[o]);return s})({1:[function(require,module,exports){
'use strict';

Object.defineProperty(exports, '__esModule', {
  value: true
});

function Chat(options) {
  if (!options || !options.session) {
    throw new Error('No session provided.');
  }
  this._session = options.session;

  var signalName = options.signalName || 'chat';
  this._session.on('signal:' + signalName, this._handleChatSignal.bind(this));
  Object.defineProperty(this, 'signalName', { value: signalName });
}

Chat.prototype = {
  constructor: Chat,

  send: function send(text, callback) {
    var signal = this._getMessageSignal(text);
    this._session.signal(signal, callback);
  },

  onMessageReceived: function onMessageReceived(type, callback) {
    callback();
  },

  _handleChatSignal: function _handleChatSignal(signal) {
    var me = this._session.connection.connectionId;
    var from = signal.from.connectionId;
    if (from !== me) {
      var handler = this.onMessageReceived;
      if (handler && typeof handler === 'function') {
        handler(signal.data, signal.from);
      }
    }
  },

  _getMessageSignal: function _getMessageSignal(text) {
    return {
      type: this.signalName,
      data: text
    };
  }
};

exports['default'] = Chat;
module.exports = exports['default'];

},{}],2:[function(require,module,exports){
'use strict';

Object.defineProperty(exports, '__esModule', {
  value: true
});

var uiLayout = ['<div class="ot-bubbles"></div>', '<div class="ot-input">', '  <p class="ot-error-zone" hidden>Error sending the message!</p>', '  <div>', '    <textarea placeholder="Write here&hellip;" class="ot-composer"></textarea>', '    <div class="ot-bottom-line">', '      <p class="ot-character-counter"><span></span> characters left</p>', '      <button class="ot-send-button">Send â€º</button>', '    </div>', '  </div>', '</div>'].join('\n');

var bubbleLayout = ['<div>', '  <header class="ot-bubble-header">', '    <p class="ot-message-sender"></p>', '    <time class="ot-message-timestamp"></time>', '  </header>', '</div>'].join('\n');

function ChatUI(options) {
  options = options || {};
  this.senderId = options.senderId || ('' + Math.random()).substr(2);
  this.senderAlias = options.senderAlias || 'me';
  this.maxTextLength = options.maxTextLength || 1000;
  this.groupDelay = options.groupDelay || 2 * 60 * 1000; // 2 min
  this.timeout = options.timeout || 5000;
  this._messages = [];
  this._setupTemplates();
  this._setupUI(options.container);
  this._updateCharCounter();
}

ChatUI.prototype = Object.defineProperties({
  constructor: ChatUI,

  _setupTemplates: function _setupTemplates() {
    this._bubbleTemplate = document.createElement('section');
    this._bubbleTemplate.innerHTML = bubbleLayout;
    this._bubbleTemplate.classList.add('ot-bubble');
  },

  _setupUI: function _setupUI(parent) {
    parent = document.querySelector(parent) || document.body;

    var chatView = document.createElement('section');
    chatView.innerHTML = uiLayout;
    chatView.classList.add('ot-textchat');

    var sendButton = chatView.querySelector('.ot-send-button');
    var composer = chatView.querySelector('.ot-composer');
    var charCounter = chatView.querySelector('.ot-character-counter > span');
    var errorZone = chatView.querySelector('.ot-error-zone');

    this._composer = composer;
    this._sendButton = sendButton;
    this._charCounter = charCounter;
    this._bubbles = chatView.firstElementChild;
    this._errorZone = errorZone;

    this._sendButton.onclick = this._sendMessage.bind(this);
    this._composer.onkeyup = this._updateCharCounter.bind(this);
    this._composer.onkeydown = this._controlComposerInput.bind(this);

    parent.appendChild(chatView);
  },

  _sendMessage: function _sendMessage() {
    var _this = this;
    var contents = this._composer.value;

    if (contents.length > _this.maxTextLength) {
      _this._showTooLongTextError();
    } else {
      _this._hideErrors();
      if (typeof _this.onMessageReadyToSend === 'function') {
        _this.disableSending();

        var timeout = setTimeout(function () {
          _this.showError();
          _this.enableSending();
        }, _this.timeout);

        var sent = _this.onMessageReadyToSend(contents, function (err) {
          clearTimeout(timeout);
          if (err) {
            _this._showError();
          } else {
            _this.addMessage(new ChatMessage(_this.senderId, _this.senderAlias, contents));
            _this._composer.value = '';
            _this._updateCharCounter();
          }
          _this.enableSending();
        });
      }
    }
  },

  _showTooLongTextError: function _showTooLongTextError() {
    this._charCounter.classList.add('error');
  },

  _showError: function _showError() {
    this._errorZone.hidden = false;
  },

  _hideErrors: function _hideErrors() {
    this._errorZone.hidden = true;
    this._charCounter.classList.remove('error');
  },

  _showError: function _showError() {
    this._errorZone.hidden = false;
  },

  _controlComposerInput: function _controlComposerInput(evt) {
    var isEnter = evt.which === 13 || evt.keyCode === 13;
    if (!evt.shiftKey && isEnter) {
      evt.preventDefault();
      this._sendMessage();
    }
  },

  _updateCharCounter: function _updateCharCounter() {
    var remaining = this.maxTextLength - this._composer.value.length;
    var isValid = remaining >= 0;
    this._charCounter.classList[!isValid ? 'add' : 'remove']('error');
    this._charCounter.textContent = remaining;
  },

  addMessage: function addMessage(message) {
    var shouldGroup = this._shouldGroup(message);
    this[shouldGroup ? '_groupBubble' : '_addNewBubble'](message);
    this._messages.push(message);
  },

  render: function render(raw, isGrouping) {
    return raw.replace(/(\r\n|\r|\n)/g, '<br/>');
  },

  enableSending: function enableSending() {
    this._sendButton.removeAttribute('disabled');
    this._composer.removeAttribute('disabled');
    this._composer.focus();
  },

  disableSending: function disableSending() {
    this._sendButton.disabled = true;
    this._composer.disabled = true;
  },

  _shouldGroup: function _shouldGroup(message) {
    if (this._lastMessage && this._lastMessage.senderId === message.senderId) {
      var reference = this._lastMessage.dateTime.getTime();
      var newDate = message.dateTime.getTime();
      return newDate - reference < this.groupDelay;
    }
    return false;
  },

  _groupBubble: function _groupBubble(message) {
    var contents = this.render(message.text, true);
    this._lastBubble.appendChild(this._getBubbleContent(contents));
    this._lastTimestamp.textContent = this._humanize(message.dateTime);
  },

  _addNewBubble: function _addNewBubble(message) {
    this._bubbles.appendChild(this._getBubble(message));
  },

  _getBubbleContent: function _getBubbleContent(safeHtml) {
    var div = document.createElement('DIV');
    div.classList.add('ot-bubble-content');
    div.innerHTML = safeHtml;
    return div;
  },

  _getBubble: function _getBubble(message) {
    var bubble = this._bubbleTemplate.cloneNode(true);
    var wrapper = bubble.querySelector('div');
    var sender = wrapper.querySelector('.ot-message-sender');
    var timestamp = wrapper.querySelector('.ot-message-timestamp');

    // Sender & alias
    bubble.dataset.senderId = message.senderId;
    if (message.senderId === this.senderId) {
      bubble.classList.add('mine');
    }
    sender.textContent = message.senderAlias;

    // Content
    var contents = this.render(message.text, false);
    wrapper.appendChild(this._getBubbleContent(contents));

    // Timestamp
    timestamp.dateTime = message.dateTime.toISOString();
    timestamp.textContent = this._humanize(message.dateTime);

    return bubble;
  },

  _humanize: function _humanize(date) {
    return date.toUTCString();
  }
}, {
  _lastMessage: {
    get: function get() {
      return this._messages[this._messages.length - 1];
    },
    configurable: true,
    enumerable: true
  },
  _lastBubble: {
    get: function get() {
      return this._bubbles.lastElementChild.querySelector('div');
    },
    configurable: true,
    enumerable: true
  },
  _lastTimestamp: {
    get: function get() {
      return this._bubbles.lastElementChild.querySelector('.ot-message-timestamp');
    },
    configurable: true,
    enumerable: true
  }
});

function ChatMessage(senderId, senderAlias, text) {
  Object.defineProperties(this, {
    senderId: { value: senderId },
    senderAlias: { value: senderAlias },
    text: { value: text },
    dateTime: { value: new Date() }
  });
}

exports.ChatUI = ChatUI;
exports.ChatMessage = ChatMessage;

},{}],3:[function(require,module,exports){
'use strict';

Object.defineProperty(exports, '__esModule', {
  value: true
});

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { 'default': obj }; }

var _Chat = require('./Chat');

var _Chat2 = _interopRequireDefault(_Chat);

var _ChatUI = require('./ChatUI');

function ChatWidget(options) {
  options = options || {};
  this._chatBox = new _ChatUI.ChatUI(options);
  this._chatBox.disableSending();
  if (options.session) {
    this.start(options);
  }
}

ChatWidget.prototype = {
  constructor: ChatWidget,

  start: function start(options) {
    if (!this._chat) {
      this._chat = new _Chat2['default'](options);
      this._chat.onMessageReceived = this.onMessageReceived.bind(this);
      this._chatBox.senderId = options.session.connection.connectionId;
      this._chatBox.senderAlias = options.session.connection.data;
      this._chatBox.onMessageReadyToSend = this.onMessageReadyToSend.bind(this);
      this._chatBox.enableSending();
    }
  },

  onMessageReadyToSend: function onMessageReadyToSend(contents, callback) {
    this._chat.send(contents, callback);
  },

  onMessageReceived: function onMessageReceived(contents, from) {
    var message = new _ChatUI.ChatMessage(from.connectionId, from.data, contents);
    this._chatBox.addMessage(message);
  }
};

exports['default'] = ChatWidget;
module.exports = exports['default'];

},{"./Chat":1,"./ChatUI":2}],4:[function(require,module,exports){
'use strict';

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { 'default': obj }; }

var _Chat = require('./Chat');

var _Chat2 = _interopRequireDefault(_Chat);

var _ChatUI = require('./ChatUI');

var _ChatWidget = require('./ChatWidget');

var _ChatWidget2 = _interopRequireDefault(_ChatWidget);

OT.TextChat = {
  Chat: _Chat2['default'],
  ChatUI: _ChatUI.ChatUI,
  ChatMessage: _ChatUI.ChatMessage,
  ChatWidget: _ChatWidget2['default']
};

},{"./Chat":1,"./ChatUI":2,"./ChatWidget":3}]},{},[4])
//# sourceMappingURL=data:application/json;charset:utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIm5vZGVfbW9kdWxlcy9icm93c2VyLXBhY2svX3ByZWx1ZGUuanMiLCIvaG9tZS9zYWx2YS93b3Jrc3BhY2Uvb3BlbnRvay10ZXh0Y2hhdC9zcmMvQ2hhdC5qcyIsIi9ob21lL3NhbHZhL3dvcmtzcGFjZS9vcGVudG9rLXRleHRjaGF0L3NyYy9DaGF0VUkuanMiLCIvaG9tZS9zYWx2YS93b3Jrc3BhY2Uvb3BlbnRvay10ZXh0Y2hhdC9zcmMvQ2hhdFdpZGdldC5qcyIsIi9ob21lL3NhbHZhL3dvcmtzcGFjZS9vcGVudG9rLXRleHRjaGF0L3NyYy9vcGVudG9rLXRleHRjaGF0LmpzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUFBOzs7Ozs7O0FDQ0EsU0FBUyxJQUFJLENBQUMsT0FBTyxFQUFFO0FBQ3JCLE1BQUksQ0FBQyxPQUFPLElBQUksQ0FBQyxPQUFPLENBQUMsT0FBTyxFQUFFO0FBQUUsVUFBTSxJQUFJLEtBQUssQ0FBQyxzQkFBc0IsQ0FBQyxDQUFDO0dBQUU7QUFDOUUsTUFBSSxDQUFDLFFBQVEsR0FBRyxPQUFPLENBQUMsT0FBTyxDQUFDOztBQUVoQyxNQUFJLFVBQVUsR0FBRyxPQUFPLENBQUMsVUFBVSxJQUFJLE1BQU0sQ0FBQztBQUM5QyxNQUFJLENBQUMsUUFBUSxDQUFDLEVBQUUsQ0FBQyxTQUFTLEdBQUcsVUFBVSxFQUFFLElBQUksQ0FBQyxpQkFBaUIsQ0FBQyxJQUFJLENBQUMsSUFBSSxDQUFDLENBQUMsQ0FBQztBQUM1RSxRQUFNLENBQUMsY0FBYyxDQUFDLElBQUksRUFBRSxZQUFZLEVBQUUsRUFBRSxLQUFLLEVBQUUsVUFBVSxFQUFFLENBQUMsQ0FBQztDQUNsRTs7QUFFRCxJQUFJLENBQUMsU0FBUyxHQUFHO0FBQ2YsYUFBVyxFQUFFLElBQUk7O0FBRWpCLE1BQUksRUFBRSxjQUFVLElBQUksRUFBRSxRQUFRLEVBQUU7QUFDOUIsUUFBSSxNQUFNLEdBQUcsSUFBSSxDQUFDLGlCQUFpQixDQUFDLElBQUksQ0FBQyxDQUFDO0FB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WUFBWSxDQUFDO0FBQ2pFLFVBQUksQ0FBQyxRQUFRLENBQUMsV0FBVyxHQUFHLE9BQU8sQ0FBQyxPQUFPLENBQUMsVUFBVSxDQUFDLElBQUksQ0FBQztBQUM1RCxVQUFJLENBQUMsUUFBUSxDQUFDLG9CQUFvQixHQUFHLElBQUksQ0FBQyxvQkFBb0IsQ0FBQyxJQUFJLENBQUMsSUFBSSxDQUFDLENBQUM7QUFDMUUsVUFBSSxDQUFDLFFBQVEsQ0FBQyxhQUFhLEVBQUUsQ0FBQztLQUMvQjtHQUNGOztBQUVELHNCQUFvQixFQUFFLDhCQUFVLFFBQVEsRUFBRSxRQUFRLEVBQUU7QUFDbEQsUUFBSSxDQUFDLEtBQUssQ0FBQyxJQUFJLENBQUMsUUFBUSxFQUFFLFFBQVEsQ0FBQyxDQUFDO0dBQ3JDOztBQUVELG1CQUFpQixFQUFFLDJCQUFVLFFBQVEsRUFBRSxJQUFJLEVBQUU7QUFDM0MsUUFBSSxPQUFPLEdBQUcsd0JBQWdCLElBQUksQ0FBQyxZQUFZLEVBQUUsSUFBSSxDQUFDLElBQUksRUFBRSxRQUFRLENBQUMsQ0FBQztBQUN0RSxRQUFJLENBQUMsUUFBUSxDQUFDLFVBQVUsQ0FBQyxPQUFPLENBQUMsQ0FBQztHQUNuQztDQUNGLENBQUM7O3FCQUVhLFVBQVU7Ozs7Ozs7O29CQ3BDUixRQUFROzs7O3NCQUNXLFVBQVU7OzBCQUN2QixjQUFjOzs7O0FBRXJDLEVBQUUsQ0FBQyxRQUFRLEdBQUc7QUFDWixNQUFJLG1CQUFNO0FBQ1YsUUFBTSxnQkFBUTtBQUNkLGFBQVcscUJBQWE7QUFDeEIsWUFBVSx5QkFBWTtDQUN2QixDQUFDIiwiZmlsZSI6ImdlbmVyYXRlZC5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzQ29udGVudCI6WyIoZnVuY3Rpb24gZSh0LG4scil7ZnVuY3Rpb24gcyhvLHUpe2lmKCFuW29dKXtpZighdFtvXSl7dmFyIGE9dHlwZW9mIHJlcXVpcmU9PVwiZnVuY3Rpb25cIiYmcmVxdWlyZTtpZighdSYmYSlyZXR1cm4gYShvLCEwKTtpZihpKXJldHVybiBpKG8sITApO3ZhciBmPW5ldyBFcnJvcihcIkNhbm5vdCBmaW5kIG1vZHVsZSAnXCIrbytcIidcIik7dGhyb3cgZi5jb2RlPVwiTU9EVUxFX05PVF9GT1VORFwiLGZ9dmFyIGw9bltvXT17ZXhwb3J0czp7fX07dFtvXVswXS5jYWxsKGwuZXhwb3J0cyxmdW5jdGlvbihlKXt2YXIgbj10W29dWzFdW2VdO3JldHVybiBzKG4/bjplKX0sbCxsLmV4cG9ydHMsZSx0LG4scil9cmV0dXJuIG5bb10uZXhwb3J0c312YXIgaT10eXBlb2YgcmVxdWlyZT09XCJmdW5jdGlvblwiJiZyZXF1aXJlO2Zvcih2YXIgbz0wO288ci5sZW5ndGg7bysrKXMocltvXSk7cmV0dXJuIHN9KSIsIlxuZnVuY3Rpb24gQ2hhdChvcHRpb25zKSB7XG4gIGlmICghb3B0aW9ucyB8fCAhb3B0aW9ucy5zZXNzaW9uKSB7IHRocm93IG5ldyBFcnJvcignTm8gc2Vzc2lvbiBwcm92aWRlZC4nKTsgfVxuICB0aGlzLl9zZXNzaW9uID0gb3B0aW9ucy5zZXNzaW9uO1xuXG4gIHZhciBzaWduYWxOYW1lID0gb3B0aW9ucy5zaWduYWxOYW1lIHx8ICdjaGF0JztcbiAgdGhpcy5fc2Vzc2lvbi5vbignc2lnbmFsOicgKyBzaWduYWxOYW1lLCB0aGlzLl9oYW5kbGVDaGF0U2lnbmFsLmJpbmQodGhpcykpO1xuICBPYmplY3QuZGVmaW5lUHJvcGVydHkodGhpcywgJ3NpZ25hbE5hbWUnLCB7IHZhbHVlOiBzaWduYWxOYW1lIH0pO1xufVxuXG5DaGF0LnByb3RvdHlwZSA9IHtcbiAgY29uc3RydWN0b3I6IENoYXQsXG5cbiAgc2VuZDogZnVuY3Rpb24gKHRleHQsIGNhbGxiYWNrKSB7XG4gICAgdmFyIHNpZ25hbCA9IHRoaXMuX2dldE1lc3NhZ2VTaWduYWwodGV4dCk7XG4gICAgdGhpcy5fc2Vzc2lvbi5zaWduYWwoc2lnbmFsLCBjYWxsYmFjayk7XG4gIH0sXG5cbiAgb25NZXNzYWdlUmVjZWl2ZWQ6IGZ1bmN0aW9uICh0eXBlLCBjYWxsYmFjaykgeyBjYWxsYmFjaygpOyB9LFxuXG4gIF9oYW5kbGVDaGF0U2lnbmFsOiBmdW5jdGlvbiAoc2lnbmFsKSB7XG4gICAgdmFyIG1lID0gdGhpcy5fc2Vzc2lvbi5jb25uZWN0aW9uLmNvbm5lY3Rpb25JZDtcbiAgICB2YXIgZnJvbSA9IHNpZ25hbC5mcm9tLmNvbm5lY3Rpb25JZDtcbiAgICBpZiAoZnJvbSAhPT0gbWUpIHtcbiAgICAgIHZhciBoYW5kbGVyID0gdGhpcy5vbk1lc3NhZ2VSZWNlaXZlZDtcbiAgICAgIGlmIChoYW5kbGVyICYmIHR5cGVvZiBoYW5kbGVyID09PSAnZnVuY3Rpb24nKSB7XG4gICAgICAgIGhhbmRsZXIoc2lnbmFsLmRhdGEsIHNpZ25hbC5mcm9tKTtcbiAgICAgIH1cbiAgICB9XG4gIH0sXG5cbiAgX2dldE1lc3NhZ2VTaWduYWw6IGZ1bmN0aW9uICh0ZXh0KSB7XG4gICAgcmV0dXJuIHtcbiAgICAgIHR5cGU6IHRoaXMuc2lnbmFsTmFtZSxcbiAgICAgIGRhdGE6IHRleHRcbiAgICB9O1xuICB9XG59O1xuXG5leHBvcnQgZGVmYXVsdCBDaGF0O1xuIiwiXG52YXIgdWlMYXlvdXQgPSBbXG4gICc8ZGl2IGNsYXNzPVwib3QtYnViYmxlc1wiPjwvZGl2PicsXG4gICc8ZGl2IGNsYXNzPVwib3QtaW5wdXRcIj4nLFxuICAnICA8cCBjbGFzcz1cIm90LWVycm9yLXpvbmVcIiBoaWRkZW4+RXJyb3Igc2VuZGluZyB0aGUgbWVzc2FnZSE8L3A+JyxcbiAgJyAgPGRpdj4nLFxuICAnICAgIDx0ZXh0YXJlYSBwbGFjZWhvbGRlcj1cIldyaXRlIGhlcmUmaGVsbGlwO1wiIGNsYXNzPVwib3QtY29tcG9zZXJcIj48L3RleHRhcmVhPicsXG4gICcgICAgPGRpdiBjbGFzcz1cIm90LWJvdHRvbS1saW5lXCI+JyxcbiAgJyAgICAgIDxwIGNsYXNzPVwib3QtY2hhcmFjdGVyLWNvdW50ZXJcIj48c3Bhbj48L3NwYW4+IGNoYXJhY3RlcnMgbGVmdDwvcD4nLFxuICAnICAgICAgPGJ1dHRvbiBjbGFzcz1cIm90LXNlbmQtYnV0dG9uXCI+U2VuZCDigLo8L2J1dHRvbj4nLFxuICAnICAgIDwvZGl2PicsXG4gICcgIDwvZGl2PicsXG4gICc8L2Rpdj4nXG5dLmpvaW4oJ1xcbicpO1xuXG52YXIgYnViYmxlTGF5b3V0ID0gW1xuICAnPGRpdj4nLFxuICAnICA8aGVhZGVyIGNsYXNzPVwib3QtYnViYmxlLWhlYWRlclwiPicsXG4gICcgICAgPHAgY2xhc3M9XCJvdC1tZXNzYWdlLXNlbmRlclwiPjwvcD4nLFxuICAnICAgIDx0aW1lIGNsYXNzPVwib3QtbWVzc2FnZS10aW1lc3RhbXBcIj48L3RpbWU+JyxcbiAgJyAgPC9oZWFkZXI+JyxcbiAgJzwvZGl2Pidcbl0uam9pbignXFxuJyk7XG5cbmZ1bmN0aW9uIENoYXRVSShvcHRpb25zKSB7XG4gIG9wdGlvbnMgPSBvcHRpb25zIHx8IHt9O1xuICB0aGlzLnNlbmRlcklkID0gb3B0aW9ucy5zZW5kZXJJZCB8fCAoJycgKyBNYXRoLnJhbmRvbSgpKS5zdWJzdHIoMik7XG4gIHRoaXMuc2VuZGVyQWxpYXMgPSBvcHRpb25zLnNlbmRlckFsaWFzIHx8ICdtZSc7XG4gIHRoaXMubWF4VGV4dExlbmd0aCA9IG9wdGlvbnMubWF4VGV4dExlbmd0aCB8fCAxMDAwO1xuICB0aGlzLmdyb3VwRGVsYXkgPSBvcHRpb25zLmdyb3VwRGVsYXkgfHwgKDIgKiA2MCAqIDEwMDApOyAvLyAyIG1pblxuICB0aGlzLnRpbWVvdXQgPSBvcHRpb25zLnRpbWVvdXQgfHwgNTAwMDtcbiAgdGhpcy5fbWVzc2FnZXMgPSBbXTtcbiAgdGhpcy5fc2V0dXBUZW1wbGF0ZXMoKTtcbiAgdGhpcy5fc2V0dXBVSShvcHRpb25zLmNvbnRhaW5lcik7XG4gIHRoaXMuX3VwZGF0ZUNoYXJDb3VudGVyKCk7XG59XG5cbkNoYXRVSS5wcm90b3R5cGUgPSB7XG4gIGNvbnN0cnVjdG9yOiBDaGF0VUksXG5cbiAgX3NldHVwVGVtcGxhdGVzOiBmdW5jdGlvbiAoKSB7XG4gICAgdGhpcy5fYnViYmxlVGVtcGxhdGUgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdzZWN0aW9uJyk7XG4gICAgdGhpcy5fYnViYmxlVGVtcGxhdGUuaW5uZXJIVE1MID0gYnViYmxlTGF5b3V0O1xuICAgIHRoaXMuX2J1YmJsZVRlbXBsYXRlLmNsYXNzTGlzdC5hZGQoJ290LWJ1YmJsZScpO1xuICB9LFxuXG4gIF9zZXR1cFVJOiBmdW5jdGlvbiAocGFyZW50KSB7XG4gICAgcGFyZW50ID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihwYXJlbnQpIHx8IGRvY3VtZW50LmJvZHk7XG5cbiAgICB2YXIgY2hhdFZpZXcgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdzZWN0aW9uJyk7XG4gICAgY2hhdFZpZXcuaW5uZXJIVE1MID0gdWlMYXlvdXQ7XG4gICAgY2hhdFZpZXcuY2xhc3NMaXN0LmFkZCgnb3QtdGV4dGNoYXQnKTtcblxuICAgIHZhciBzZW5kQnV0dG9uID0gY2hhdFZpZXcucXVlcnlTZWxlY3RvcignLm90LXNlbmQtYnV0dG9uJyk7XG4gICAgdmFyIGNvbXBvc2VyID0gY2hhdFZpZXcucXVlcnlTZWxlY3RvcignLm90LWNvbXBvc2VyJyk7XG4gICAgdmFyIGNoYXJDb3VudGVyID0gY2hhdFZpZXcucXVlcnlTZWxlY3RvcignLm90LWNoYXJhY3Rlci1jb3VudGVyID4gc3BhbicpO1xuICAgIHZhciBlcnJvclpvbmUgPSBjaGF0Vmlldy5xdWVyeVNlbGVjdG9yKCcub3QtZXJyb3Item9uZScpO1xuXG4gICAgdGhpcy5fY29tcG9zZXIgPSBjb21wb3NlcjtcbiAgICB0aGlzLl9zZW5kQnV0dG9uID0gc2VuZEJ1dHRvbjtcbiAgICB0aGlzLl9jaGFyQ291bnRlciA9IGNoYXJDb3VudGVyO1xuICAgIHRoaXMuX2J1YmJsZXMgPSBjaGF0Vmlldy5maXJzdEVsZW1lbnRDaGlsZDtcbiAgICB0aGlzLl9lcnJvclpvbmUgPSBlcnJvclpvbmU7XG5cbiAgICB0aGlzLl9zZW5kQnV0dG9uLm9uY2xpY2sgPSB0aGlzLl9zZW5kTWVzc2FnZS5iaW5kKHRoaXMpO1xuICAgIHRoaXMuX2NvbXBvc2VyLm9ua2V5dXAgPSB0aGlzLl91cGRhdGVDaGFyQ291bnRlci5iaW5kKHRoaXMpO1xuICAgIHRoaXMuX2NvbXBvc2VyLm9ua2V5ZG93biA9IHRoaXMuX2NvbnRyb2xDb21wb3NlcklucHV0LmJpbmQodGhpcyk7XG5cbiAgICBwYXJlbnQuYXBwZW5kQ2hpbGQoY2hhdFZpZXcpO1xuICB9LFxuXG4gIF9zZW5kTWVzc2FnZTogZnVuY3Rpb24gKCkge1xuICAgIHZhciBfdGhpcyA9IHRoaXM7XG4gICAgdmFyIGNvbnRlbnRzID0gdGhpcy5fY29tcG9zZXIudmFsdWU7XG5cbiAgICBpZiAoY29udGVudHMubGVuZ3RoID4gX3RoaXMubWF4VGV4dExlbmd0aCkge1xuICAgICAgX3RoaXMuX3Nob3dUb29Mb25nVGV4dEVycm9yKCk7XG4gICAgfVxuICAgIGVsc2Uge1xuICAgICAgX3RoaXMuX2hpZGVFcnJvcnMoKTtcbiAgICAgIGlmICh0eXBlb2YgX3RoaXMub25NZXNzYWdlUmVhZHlUb1NlbmQgPT09ICdmdW5jdGlvbicpIHtcbiAgICAgICAgX3RoaXMuZGlzYWJsZVNlbmRpbmcoKTtcblxuICAgICAgICB2YXIgdGltZW91dCA9IHNldFRpbWVvdXQoZnVuY3Rpb24gKCkge1xuICAgICAgICAgIF90aGlzLnNob3dFcnJvcigpO1xuICAgICAgICAgIF90aGlzLmVuYWJsZVNlbmRpbmcoKTtcbiAgICAgICAgfSwgX3RoaXMudGltZW91dCk7XG5cbiAgICAgICAgdmFyIHNlbnQgPSBfdGhpcy5vbk1lc3NhZ2VSZWFkeVRvU2VuZChjb250ZW50cywgZnVuY3Rpb24gKGVycikge1xuICAgICAgICAgIGNsZWFyVGltZW91dCh0aW1lb3V0KTtcbiAgICAgICAgICBpZiAoZXJyKSB7XG4gICAgICAgICAgICBfdGhpcy5fc2hvd0Vycm9yKCk7XG4gICAgICAgICAgfVxuICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgX3RoaXMuYWRkTWVzc2FnZShuZXcgQ2hhdE1lc3NhZ2UoXG4gICAgICAgICAgICAgIF90aGlzLnNlbmRlcklkLFxuICAgICAgICAgICAgICBfdGhpcy5zZW5kZXJBbGlhcyxcbiAgICAgICAgICAgICAgY29udGVudHNcbiAgICAgICAgICAgICkpO1xuICAgICAgICAgICAgX3RoaXMuX2NvbXBvc2VyLnZhbHVlID0gJyc7XG4gICAgICAgICAgICBfdGhpcy5fdXBkYXRlQ2hhckNvdW50ZXIoKTtcbiAgICAgICAgICB9XG4gICAgICAgICAgX3RoaXMuZW5hYmxlU2VuZGluZygpO1xuICAgICAgICB9KTtcblxuICAgICAgfVxuICAgIH1cbiAgfSxcblxuICBfc2hvd1Rvb0xvbmdUZXh0RXJyb3I6IGZ1bmN0aW9uICgpIHtcbiAgICB0aGlzLl9jaGFyQ291bnRlci5jbGFzc0xpc3QuYWRkKCdlcnJvcicpO1xuICB9LFxuXG4gIF9zaG93RXJyb3I6IGZ1bmN0aW9uICgpIHtcbiAgICB0aGlzLl9lcnJvclpvbmUuaGlkZGVuID0gZmFsc2U7XG4gIH0sXG5cbiAgX2hpZGVFcnJvcnM6IGZ1bmN0aW9uICgpIHtcbiAgICB0aGlzLl9lcnJvclpvbmUuaGlkZGVuID0gdHJ1ZTtcbiAgICB0aGlzLl9jaGFyQ291bnRlci5jbGFzc0xpc3QucmVtb3ZlKCdlcnJvcicpO1xuICB9LFxuXG4gIF9zaG93RXJyb3I6IGZ1bmN0aW9uICgpIHtcbiAgICB0aGlzLl9lcnJvclpvbmUuaGlkZGVuID0gZmFsc2U7XG4gIH0sXG5cbiAgX2NvbnRyb2xDb21wb3NlcklucHV0OiBmdW5jdGlvbiAoZXZ0KSB7XG4gICAgdmFyIGlzRW50ZXIgPSBldnQud2hpY2ggPT09IDEzIHx8IGV2dC5rZXlDb2RlID09PSAxMztcbiAgICBpZiAoIWV2dC5zaGlmdEtleSAmJiBpc0VudGVyKSB7XG4gICAgICBldnQucHJldmVudERlZmF1bHQoKTtcbiAgICAgIHRoaXMuX3NlbmRNZXNzYWdlKCk7XG4gICAgfVxuICB9LFxuXG4gIF91cGRhdGVDaGFyQ291bnRlcjogZnVuY3Rpb24gKCkge1xuICAgIHZhciByZW1haW5pbmcgPSB0aGlzLm1heFRleHRMZW5ndGggLSB0aGlzLl9jb21wb3Nlci52YWx1ZS5sZW5ndGg7XG4gICAgdmFyIGlzVmFsaWQgPSByZW1haW5pbmcgPj0gMDtcbiAgICB0aGlzLl9jaGFyQ291bnRlci5jbGFzc0xpc3RbIWlzVmFsaWQgPyAnYWRkJyA6ICdyZW1vdmUnXSgnZXJyb3InKTtcbiAgICB0aGlzLl9jaGFyQ291bnRlci50ZXh0Q29udGVudCA9IHJlbWFpbmluZztcbiAgfSxcblxuICBhZGRNZXNzYWdlOiBmdW5jdGlvbiAobWVzc2FnZSkge1xuICAgIHZhciBzaG91bGRHcm91cCA9IHRoaXMuX3Nob3VsZEdyb3VwKG1lc3NhZ2UpO1xuICAgIHRoaXNbIHNob3VsZEdyb3VwID8gJ19ncm91cEJ1YmJsZScgOiAnX2FkZE5ld0J1YmJsZScgXShtZXNzYWdlKTtcbiAgICB0aGlzLl9tZXNzYWdlcy5wdXNoKG1lc3NhZ2UpO1xuICB9LFxuXG4gIHJlbmRlcjogZnVuY3Rpb24gKHJhdywgaXNHcm91cGluZykge1xuICAgIHJldHVybiByYXcucmVwbGFjZSgvKFxcclxcbnxcXHJ8XFxuKS9nLCAnPGJyLz4nKTtcbiAgfSxcblxuICBlbmFibGVTZW5kaW5nOiBmdW5jdGlvbiAoKSB7XG4gICAgdGhpcy5fc2VuZEJ1dHRvbi5yZW1vdmVBdHRyaWJ1dGUoJ2Rpc2FibGVkJyk7XG4gICAgdGhpcy5fY29tcG9zZXIucmVtb3ZlQXR0cmlidXRlKCdkaXNhYmxlZCcpO1xuICAgIHRoaXMuX2NvbXBvc2VyLmZvY3VzKCk7XG4gIH0sXG5cbiAgZGlzYWJsZVNlbmRpbmc6IGZ1bmN0aW9uICgpIHtcbiAgICB0aGlzLl9zZW5kQnV0dG9uLmRpc2FibGVkID0gdHJ1ZTtcbiAgICB0aGlzLl9jb21wb3Nlci5kaXNhYmxlZCA9IHRydWU7XG4gIH0sXG5cbiAgX3Nob3VsZEdyb3VwOiBmdW5jdGlvbiAobWVzc2FnZSkge1xuICAgIGlmICh0aGlzLl9sYXN0TWVzc2FnZSAmJiB0aGlzLl9sYXN0TWVzc2FnZS5zZW5kZXJJZCA9PT0gbWVzc2FnZS5zZW5kZXJJZCkge1xuICAgICAgdmFyIHJlZmVyZW5jZSA9IHRoaXMuX2xhc3RNZXNzYWdlLmRhdGVUaW1lLmdldFRpbWUoKTtcbiAgICAgIHZhciBuZXdEYXRlID0gbWVzc2FnZS5kYXRlVGltZS5nZXRUaW1lKCk7XG4gICAgICByZXR1cm4gbmV3RGF0ZSAtIHJlZmVyZW5jZSA8IHRoaXMuZ3JvdXBEZWxheTtcbiAgICB9XG4gICAgcmV0dXJuIGZhbHNlO1xuICB9LFxuXG4gIF9ncm91cEJ1YmJsZTogZnVuY3Rpb24gKG1lc3NhZ2UpIHtcbiAgICB2YXIgY29udGVudHMgPSB0aGlzLnJlbmRlcihtZXNzYWdlLnRleHQsIHRydWUpO1xuICAgIHRoaXMuX2xhc3RCdWJibGUuYXBwZW5kQ2hpbGQodGhpcy5fZ2V0QnViYmxlQ29udGVudChjb250ZW50cykpO1xuICAgIHRoaXMuX2xhc3RUaW1lc3RhbXAudGV4dENvbnRlbnQgPSB0aGlzLl9odW1hbml6ZShtZXNzYWdlLmRhdGVUaW1lKTtcbiAgfSxcblxuICBfYWRkTmV3QnViYmxlOiBmdW5jdGlvbiAobWVzc2FnZSkge1xuICAgIHRoaXMuX2J1YmJsZXMuYXBwZW5kQ2hpbGQodGhpcy5fZ2V0QnViYmxlKG1lc3NhZ2UpKTtcbiAgfSxcblxuICBnZXQgX2xhc3RNZXNzYWdlKCkge1xuICAgIHJldHVybiB0aGlzLl9tZXNzYWdlc1t0aGlzLl9tZXNzYWdlcy5sZW5ndGggLSAxXTtcbiAgfSxcblxuICBnZXQgX2xhc3RCdWJibGUoKSB7XG4gICAgcmV0dXJuIHRoaXMuX2J1YmJsZXMubGFzdEVsZW1lbnRDaGlsZC5xdWVyeVNlbGVjdG9yKCdkaXYnKTtcbiAgfSxcblxuICBnZXQgX2xhc3RUaW1lc3RhbXAoKSB7XG4gICAgcmV0dXJuIHRoaXMuX2J1YmJsZXNcbiAgICAgIC5sYXN0RWxlbWVudENoaWxkLnF1ZXJ5U2VsZWN0b3IoJy5vdC1tZXNzYWdlLXRpbWVzdGFtcCcpO1xuICB9LFxuXG4gIF9nZXRCdWJibGVDb250ZW50OiBmdW5jdGlvbiAoc2FmZUh0bWwpIHtcbiAgICB2YXIgZGl2ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnRElWJyk7XG4gICAgZGl2LmNsYXNzTGlzdC5hZGQoJ290LWJ1YmJsZS1jb250ZW50Jyk7XG4gICAgZGl2LmlubmVySFRNTCA9IHNhZmVIdG1sO1xuICAgIHJldHVybiBkaXY7XG4gIH0sXG5cbiAgX2dldEJ1YmJsZTogZnVuY3Rpb24gKG1lc3NhZ2UpIHtcbiAgICB2YXIgYnViYmxlID0gdGhpcy5fYnViYmxlVGVtcGxhdGUuY2xvbmVOb2RlKHRydWUpO1xuICAgIHZhciB3cmFwcGVyID0gYnViYmxlLnF1ZXJ5U2VsZWN0b3IoJ2RpdicpO1xuICAgIHZhciBzZW5kZXIgPSB3cmFwcGVyLnF1ZXJ5U2VsZWN0b3IoJy5vdC1tZXNzYWdlLXNlbmRlcicpO1xuICAgIHZhciB0aW1lc3RhbXAgPSB3cmFwcGVyLnF1ZXJ5U2VsZWN0b3IoJy5vdC1tZXNzYWdlLXRpbWVzdGFtcCcpO1xuXG4gICAgLy8gU2VuZGVyICYgYWxpYXNcbiAgICBidWJibGUuZGF0YXNldC5zZW5kZXJJZCA9IG1lc3NhZ2Uuc2VuZGVySWQ7XG4gICAgaWYgKG1lc3NhZ2Uuc2VuZGVySWQgPT09IHRoaXMuc2VuZGVySWQpIHtcbiAgICAgIGJ1YmJsZS5jbGFzc0xpc3QuYWRkKCdtaW5lJyk7XG4gICAgfVxuICAgIHNlbmRlci50ZXh0Q29udGVudCA9IG1lc3NhZ2Uuc2VuZGVyQWxpYXM7XG5cbiAgICAvLyBDb250ZW50XG4gICAgdmFyIGNvbnRlbnRzID0gdGhpcy5yZW5kZXIobWVzc2FnZS50ZXh0LCBmYWxzZSk7XG4gICAgd3JhcHBlci5hcHBlbmRDaGlsZCh0aGlzLl9nZXRCdWJibGVDb250ZW50KGNvbnRlbnRzKSk7XG5cbiAgICAvLyBUaW1lc3RhbXBcbiAgICB0aW1lc3RhbXAuZGF0ZVRpbWUgPSBtZXNzYWdlLmRhdGVUaW1lLnRvSVNPU3RyaW5nKCk7XG4gICAgdGltZXN0YW1wLnRleHRDb250ZW50ID0gdGhpcy5faHVtYW5pemUobWVzc2FnZS5kYXRlVGltZSk7XG5cbiAgICByZXR1cm4gYnViYmxlO1xuICB9LFxuXG4gIF9odW1hbml6ZTogZnVuY3Rpb24gKGRhdGUpIHtcbiAgICByZXR1cm4gZGF0ZS50b1VUQ1N0cmluZygpO1xuICB9XG59O1xuXG5mdW5jdGlvbiBDaGF0TWVzc2FnZShzZW5kZXJJZCwgc2VuZGVyQWxpYXMsIHRleHQpIHtcbiAgT2JqZWN0LmRlZmluZVByb3BlcnRpZXModGhpcywge1xuICAgIHNlbmRlcklkOiB7IHZhbHVlOiBzZW5kZXJJZCB9LFxuICAgIHNlbmRlckFsaWFzOiB7IHZhbHVlOiBzZW5kZXJBbGlhcyB9LFxuICAgIHRleHQ6IHsgdmFsdWU6IHRleHQgfSxcbiAgICBkYXRlVGltZTogeyB2YWx1ZTogbmV3IERhdGUoKSB9XG4gIH0pO1xufVxuXG5leHBvcnQgeyBDaGF0VUksIENoYXRNZXNzYWdlIH07XG4iLCJcbmltcG9ydCBDaGF0IGZyb20gJy4vQ2hhdCc7XG5pbXBvcnQgeyBDaGF0VUksIENoYXRNZXNzYWdlIH0gZnJvbSAnLi9DaGF0VUknO1xuXG5mdW5jdGlvbiBDaGF0V2lkZ2V0KG9wdGlvbnMpIHtcbiAgb3B0aW9ucyA9IG9wdGlvbnMgfHwge307XG4gIHRoaXMuX2NoYXRCb3ggPSBuZXcgQ2hhdFVJKG9wdGlvbnMpO1xuICB0aGlzLl9jaGF0Qm94LmRpc2FibGVTZW5kaW5nKCk7XG4gIGlmIChvcHRpb25zLnNlc3Npb24pIHtcbiAgICB0aGlzLnN0YXJ0KG9wdGlvbnMpO1xuICB9XG59XG5cbkNoYXRXaWRnZXQucHJvdG90eXBlID0ge1xuICBjb25zdHJ1Y3RvcjogQ2hhdFdpZGdldCxcblxuICBzdGFydDogZnVuY3Rpb24gKG9wdGlvbnMpIHtcbiAgICBpZiAoIXRoaXMuX2NoYXQpIHtcbiAgICAgIHRoaXMuX2NoYXQgPSBuZXcgQ2hhdChvcHRpb25zKTtcbiAgICAgIHRoaXMuX2NoYXQub25NZXNzYWdlUmVjZWl2ZWQgPSB0aGlzLm9uTWVzc2FnZVJlY2VpdmVkLmJpbmQodGhpcyk7XG4gICAgICB0aGlzLl9jaGF0Qm94LnNlbmRlcklkID0gb3B0aW9ucy5zZXNzaW9uLmNvbm5lY3Rpb24uY29ubmVjdGlvbklkO1xuICAgICAgdGhpcy5fY2hhdEJveC5zZW5kZXJBbGlhcyA9IG9wdGlvbnMuc2Vzc2lvbi5jb25uZWN0aW9uLmRhdGE7XG4gICAgICB0aGlzLl9jaGF0Qm94Lm9uTWVzc2FnZVJlYWR5VG9TZW5kID0gdGhpcy5vbk1lc3NhZ2VSZWFkeVRvU2VuZC5iaW5kKHRoaXMpO1xuICAgICAgdGhpcy5fY2hhdEJveC5lbmFibGVTZW5kaW5nKCk7XG4gICAgfVxuICB9LFxuXG4gIG9uTWVzc2FnZVJlYWR5VG9TZW5kOiBmdW5jdGlvbiAoY29udGVudHMsIGNhbGxiYWNrKSB7XG4gICAgdGhpcy5fY2hhdC5zZW5kKGNvbnRlbnRzLCBjYWxsYmFjayk7XG4gIH0sXG5cbiAgb25NZXNzYWdlUmVjZWl2ZWQ6IGZ1bmN0aW9uIChjb250ZW50cywgZnJvbSkge1xuICAgIHZhciBtZXNzYWdlID0gbmV3IENoYXRNZXNzYWdlKGZyb20uY29ubmVjdGlvbklkLCBmcm9tLmRhdGEsIGNvbnRlbnRzKTtcbiAgICB0aGlzLl9jaGF0Qm94LmFkZE1lc3NhZ2UobWVzc2FnZSk7XG4gIH1cbn07XG5cbmV4cG9ydCBkZWZhdWx0IENoYXRXaWRnZXQ7XG4iLCJcbmltcG9ydCBDaGF0IGZyb20gJy4vQ2hhdCc7XG5pbXBvcnQgeyBDaGF0VUksIENoYXRNZXNzYWdlIH0gZnJvbSAnLi9DaGF0VUknO1xuaW1wb3J0IENoYXRXaWRnZXQgZnJvbSAnLi9DaGF0V2lkZ2V0JztcblxuT1QuVGV4dENoYXQgPSB7XG4gIENoYXQ6IENoYXQsXG4gIENoYXRVSTogQ2hhdFVJLFxuICBDaGF0TWVzc2FnZTogQ2hhdE1lc3NhZ2UsXG4gIENoYXRXaWRnZXQ6IENoYXRXaWRnZXRcbn07XG4iXX0=
